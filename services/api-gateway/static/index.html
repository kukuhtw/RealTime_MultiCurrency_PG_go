<!-- services/api-gateway/static/index.html -->
<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Payment Gateway PoC</title>
  <style>
    body{font-family:system-ui,Arial;margin:24px}
    form, .row{display:grid;gap:12px;max-width:520px}
    input,select,button{padding:10px;font-size:14px}
    .status{margin-top:12px;padding:10px;border:1px solid #ddd}
    iframe{width:100%;height:360px;border:1px solid #ddd;margin-top:16px}
  </style>
</head>
<body>
  <h1>Payment Gateway PoC</h1>
  <form id="f">
    <label>Sender Account ID <input id="sender" required></label>
    <label>Receiver Account ID <input id="receiver" required></label>
    <label>Currency
      <select id="cur">
        <option>IDR</option><option>USD</option><option>SGD</option>
      </select>
    </label>
    <label>Amount <input id="amt" type="number" step="0.01" required></label>
    <button type="button" id="rand">Ambil Acak dari DB</button>
    <button>Kirim</button>
  </form>

  <div class="status" id="status">Status: -</div>

  <h3>Grafana</h3>
  <iframe src="http://localhost:3000/d/auto/payment-poc?orgId=1&kiosk"></iframe>

  <script>
    const api = location.origin.replace(':8080', ':8080'); // same host
    document.getElementById('rand').onclick = async () => {
      const r = await fetch('/api/random-accounts'); // endpoint dari gateway -> db-rs:GetRandomAccounts
      const j = await r.json();
      document.getElementById('sender').value = j.sender_id;
      document.getElementById('receiver').value = j.receiver_id;
    };
    document.getElementById('f').onsubmit = async (e) => {
      e.preventDefault();
      const payload = {
        sender_id: document.getElementById('sender').value,
        receiver_id: document.getElementById('receiver').value,
        currency: document.getElementById('cur').value,
        amount: parseFloat(document.getElementById('amt').value),
        tx_date: new Date().toISOString(),
        idempotency_key: crypto.randomUUID()
      };
      const r = await fetch('/api/payments', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      const j = await r.json();
      document.getElementById('status').textContent = 'Status: ' + j.status + (j.reason? (' ('+j.reason+')') : '');
    };
  </script>
</body>
</html>
